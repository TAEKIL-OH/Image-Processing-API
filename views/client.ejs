<!--
Taekil Oh
FEb 20 2024
client.ejs
purpose: cleint-side for image processing
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Upload and Display Image without Saving</title>
</head>

<body>
    <h2>Upload Image</h2>

    <form id="uploadForm" enctype="multipart/form-data">
        <input type="file" name="image" id="imageInput" required>
        <button type="button" id="uploadButton">Upload Image</button>
    </form>
    
    <!-- Container for images -->
    <div id="imageContainer">
        <!-- Original Image -->
        <img id="displayedImage" alt="Uploaded Image" style="display:none;">

        <!-- Thumbnail Image (if generated) will be inserted here -->
        <div id="thumbnailContainer">
            <img id="thumbnailImage" alt="Thumbnail Image" style="display:none;">
            <p id="thumbnailMessage" style="display:none;">No thumbnail yet</p>
        </div>    
    </div>

    <form id="verticalFlipForm">
        <button type="button" id="verticalFlipButton">Flip in vertical</button>
    </form>

    <form id="horizontalFlipForm">
        <button type="button" id="horizontalFlipButton">Flip in horizontal</button>
    </form>

    <form id="colorGreyForm">
        <button type="button" id="colorGreyButton">color into grey</button>
    </form>

    <form id="rigthRotatingForm">
        <button type="button" id="rightRotatingButton">right-rotating in 90 degrees</button>
    </form>

    <form id="leftRotatingForm">
        <button type="button" id="leftRotatingButton">left-rotating in 90 degrees</button>
    </form>

    <form id="thumbnailForm">
        <button type="button" id="thumbnailingButton">generating thumbnail</button>
    </form>

    <form id="angleRotatingForm">
        <label for="angleInput">Enter rotation angle:</label>
        <input type="number" id="angleInput" name="angle" required>
        <button type="button" id="angleRotatingButton">degree angle Rotating</button>
    </form>

    <form id="openAPIForm">
        <button type="button" id="openAPIbutton">openAPI Live Documentation</button>
    </form>

<script>

    // image uploading
    document.getElementById('uploadButton').addEventListener('click', function() {
        var formData = new FormData();
        formData.append('image', document.getElementById('imageInput').files[0]);

        fetch('/upload', {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            if(data.imageUrl) {
                document.getElementById('displayedImage').src = data.imageUrl;
                document.getElementById('displayedImage').style.display = 'block';
            } else {
                console.error('Error:', data.error);
            }
        })
        .catch(error => console.error('Error:', error));
    });

    // up-down flip
    document.getElementById('verticalFlipButton').addEventListener('click', function() {
        const imageSrc = document.getElementById('displayedImage').src;
        fetch('/verticalFlip', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ imageData: imageSrc }),
        })
        .then(response => response.json())
        .then(data => {
            if(data.imageUrl) {
                document.getElementById('displayedImage').src = data.imageUrl;
            } else {
                console.error('Error:', data.error);
            }
        })
        .catch(error => console.error('Error:', error));
    });
    
    // left-right flip
    document.getElementById('horizontalFlipButton').addEventListener('click', function() {
        const imageSrc = document.getElementById('displayedImage').src;
        fetch('/horizontalFlip', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ imageData: imageSrc }),
        })
        .then(response => response.json())
        .then(data => {
            if(data.imageUrl) {
                document.getElementById('displayedImage').src = data.imageUrl;
            } else {
                console.error('Error:', data.error);
            }
        })
        .catch(error => console.error('Error:', error));
    });

    // converting to grey
    document.getElementById('colorGreyButton').addEventListener('click', function() {
        const imageSrc = document.getElementById('displayedImage').src;
        fetch('/colorToGrey', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ imageData: imageSrc }),
        })
        .then(response => response.json())
        .then(data => {
            if(data.imageUrl) {
                document.getElementById('displayedImage').src = data.imageUrl;
            } else {
                console.error('Error:', data.error);
            }
        })
        .catch(error => console.error('Error:', error));
    });

    // + 90 angle rotating generating
    document.getElementById('rightRotatingButton').addEventListener('click', function() {
        const imageSrc = document.getElementById('displayedImage').src;
        fetch('/rightRotating', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ imageData: imageSrc }),
        })
        .then(response => response.json())
        .then(data => {
            if(data.imageUrl) {
                document.getElementById('displayedImage').src = data.imageUrl;
            } else {
                console.error('Error:', data.error);
            }
        })
        .catch(error => console.error('Error:', error));
    });

    // - 90 angle rotating generating
    document.getElementById('leftRotatingButton').addEventListener('click', function() {
        const imageSrc = document.getElementById('displayedImage').src;
        fetch('/leftRotating', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ imageData: imageSrc }),
        })
        .then(response => response.json())
        .then(data => {
            if(data.imageUrl) {
                document.getElementById('displayedImage').src = data.imageUrl;
            } else {
                console.error('Error:', data.error);
            }
        })
        .catch(error => console.error('Error:', error));
    });

    // thumbnail generating
    // thumbnail generating
    document.getElementById('thumbnailingButton').addEventListener('click', function() {
        const imageSrc = document.getElementById('displayedImage').src;
        fetch('/generatingThumbnail', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ imageData: imageSrc }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.thumbnailUrl) {
                // Show thumbnail image
                document.getElementById('thumbnailImage').src = data.thumbnailUrl;
                document.getElementById('thumbnailImage').style.display = 'block';
                document.getElementById('thumbnailMessage').style.display = 'none';
            } else {
                // Show message indicating no thumbnail yet
                document.getElementById('thumbnailImage').style.display = 'none';
                document.getElementById('thumbnailMessage').style.display = 'block';
            }
        })
        .catch(error => console.error('Error:', error));
    });

    // angle rotating generating
    document.getElementById('angleRotatingButton').addEventListener('click', function() {
        const imageSrc = document.getElementById('displayedImage').src;
        const angle = document.getElementById('angleInput').value; // get the user input 
        fetch('/angleRotating', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ 
                imageData: imageSrc,
                rotationAngle: angle // pass the angle
             }),
        })
        .then(response => response.json())
        .then(data => {
            if(data.imageUrl) {
                document.getElementById('displayedImage').src = data.imageUrl;
            } else {
                console.error('Error:', data.error);
            }
        })
        .catch(error => console.error('Error:', error));
    });

    document.getElementById('openAPIbutton').addEventListener('click', function() {
    window.open('http://localhost:3000/openapi-docs', '_blank');
    });

</script>

</body>

</html>

